<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elixir Radio - Vinyl Store Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .album-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .album-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .album-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 5px;
        }
        
        .artist-name {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .track-list {
            list-style: none;
            margin-top: 10px;
        }
        
        .track-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
        }
        
        .track-info {
            flex: 1;
        }
        
        .track-number {
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }
        
        .track-title {
            color: #333;
        }
        
        .track-duration {
            color: #999;
            font-size: 0.9em;
            margin-left: 10px;
        }
        
        .play-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s;
        }
        
        .play-button:hover {
            background: #764ba2;
        }
        
        .play-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .player-section {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .now-playing {
            margin-bottom: 15px;
            color: #333;
        }
        
        audio {
            width: 100%;
            margin-top: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
        
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ Elixir Radio</h1>
        <p class="subtitle">Vinyl Record Store - Audio Preview Demo</p>
        
        <div class="info-box">
            <strong>Welcome!</strong> Browse albums and click "Play Sample" to listen to 60-second previews of each track.
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="loading" class="loading">Loading catalog...</div>
        
        <div id="content" style="display: none;">
            <div class="section">
                <h2 class="section-title">Albums</h2>
                <div id="albums" class="album-grid"></div>
            </div>
            
            <div class="player-section">
                <div class="now-playing" id="nowPlaying">No track playing</div>
                <audio id="audioPlayer" controls style="display: none;"></audio>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:4000';
        let currentTrack = null;
        
        async function loadAlbums() {
            try {
                const response = await fetch(`${API_BASE}/api/albums`);
                if (!response.ok) throw new Error('Failed to load albums');
                
                const data = await response.json();
                displayAlbums(data.albums);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                showError('Failed to load catalog. Make sure the server is running on port 4000.');
                console.error('Error:', error);
            }
        }
        
        function displayAlbums(albums) {
            const container = document.getElementById('albums');
            container.innerHTML = '';
            
            if (albums.length === 0) {
                container.innerHTML = '<p>No albums found. Run the seed script to add sample data.</p>';
                return;
            }
            
            albums.forEach(album => {
                const card = document.createElement('div');
                card.className = 'album-card';
                
                const tracks = (album.tracks || [])
                    .sort((a, b) => a.track_number - b.track_number)
                    .map(track => `
                        <li class="track-item">
                            <div class="track-info">
                                <span class="track-number">${track.track_number}.</span>
                                <span class="track-title">${track.title}</span>
                                ${track.duration_seconds ? 
                                    `<span class="track-duration">${formatDuration(track.duration_seconds)}</span>` 
                                    : ''}
                            </div>
                            <button class="play-button" 
                                    onclick="playTrack(${track.id})"
                                    ${!track.stream_id ? 'disabled title="No stream available"' : ''}>
                                ${track.stream_id ? 'Play Sample' : 'No Stream'}
                            </button>
                        </li>
                    `).join('');
                
                card.innerHTML = `
                    <h3 class="album-title">${album.title}</h3>
                    <p class="artist-name">${album.artist.name}</p>
                    ${album.release_year ? `<p style="color: #999;">Released: ${album.release_year}</p>` : ''}
                    <ul class="track-list">${tracks}</ul>
                `;
                
                container.appendChild(card);
            });
        }
        
        async function playTrack(trackId) {
            try {
                const response = await fetch(`${API_BASE}/api/tracks/${trackId}`);
                if (!response.ok) throw new Error('Failed to load track');
                
                const data = await response.json();
                const track = data.track;
                
                if (!track.stream_url) {
                    showError('No stream available for this track');
                    return;
                }
                
                const player = document.getElementById('audioPlayer');
                const nowPlaying = document.getElementById('nowPlaying');
                
                player.src = `${API_BASE}${track.stream_url}`;
                player.style.display = 'block';
                player.play();
                
                nowPlaying.textContent = `Now Playing: ${track.album.artist.name} - ${track.title} (${track.sample_duration}s sample)`;
                currentTrack = track;
                
            } catch (error) {
                showError('Failed to play track');
                console.error('Error:', error);
            }
        }
        
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }
        
        // Load albums on page load
        loadAlbums();
    </script>
</body>
</html>
